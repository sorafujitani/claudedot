# Module Documentation Generator

指定されたモジュール（ファイルまたはディレクトリ）の実装について、理解しやすいドキュメントを生成します。

## 目的と哲学

このドキュメント生成の目的は、**ユーザーが優れた開発者になることを支援する**ことです。単なる実装の説明ではなく、以下を重視します：

- **基礎から応用まで**: 言語仕様の基礎知識から高度な実装パターンまでカバー
- **実践的な学習**: 実際のコードを通じて概念を理解
- **問題解決能力の向上**: なぜその実装になったのか、どんな議論があったのかを理解
- **コミュニティの知見**: GitHub Issues/Discussionから実際の問題と解決策を学ぶ
- **深い理解**: 表面的な使い方だけでなく、内部動作や設計思想まで解説

## 引数

- `$ARGUMENTS` - ドキュメント化対象のファイルパス（オプション）
  - 指定がない場合はユーザーに確認する

## 実行手順

1. **対象の特定**
   - 引数でファイルパスが指定されていればそれを使用
   - 指定がなければユーザーに対象モジュールを質問

2. **対象の読み込み**
   - 指定されたパスのファイル/ディレクトリを読み込む
   - 複数ファイルの場合は関連性を把握する
   - 手元のコードでの実際の使われ方を確認

3. **言語仕様の基礎知識の収集**
   - 使用している言語機能の基礎概念を特定
   - 初心者が理解すべき前提知識をリストアップ
   - 段階的な学習パスを構築（基礎→中級→上級）

4. **公式ドキュメントとコミュニティリソースの参照**
   - 使用しているツール、ライブラリ、言語機能の公式ドキュメントを特定
   - 関連するAPIリファレンスのURLを収集
   - ベストプラクティスや推奨事項を確認
   - **GitHub Issues/Discussionの調査**:
     - 関連する問題や議論を検索
     - 実装の背景や設計決定の経緯を理解
     - よくある落とし穴や回避策を収集
   - **Stack Overflowや技術ブログ**から実践的な知見を収集

5. **構造分析**
   - クラス/モジュール構造
   - 主要なメソッドと役割
   - 依存関係（require/import）
   - 公開API vs 内部実装
   - インターフェースの設計と実装の詳細

6. **実装詳細の分析**
   - 各メソッドの入出力値の具体例（実際にデバッグした時に出力される値）
   - 中間データの構造（ハッシュ、配列、オブジェクトの中身）
   - 最小単位でのデバッグ手法（REPL、テスト、ログ出力など）
   - 典型的なデバッグシナリオとブレークポイントの置き場所
   - 言語仕様の活用方法（メタプログラミング、型システム、並行処理など）

7. **ドキュメント生成**

   以下の形式でMarkdownドキュメントを作成し、**必ずClaude Codeの出力として結果をまとめる**:

   ```markdown
   # [モジュール名] 解説

   **ファイル**: `path/to/file`

   ## 概要
   [モジュールの目的と責務を1-3文で説明]

   ## 言語仕様の基礎知識

   ### 前提知識
   - **必須の基礎概念**: [このコードを理解するために必要な言語の基本概念]
   - **理解しておくべきパターン**: [デザインパターン、イディオム等]
   
   ### 学習パス
   1. **初級**: [基礎概念の説明とリンク]
   2. **中級**: [応用的な使い方とリンク]
   3. **上級**: [このコードで使われている高度な技法]

   ## 公式ドキュメント参照
   
   ### 使用技術の公式リンク
   - **[ライブラリ/ツール名]**: [公式ドキュメントURL]
     - APIリファレンス: [具体的なAPI参照URL]
     - 関連する仕様: [該当する言語仕様のURL]
     - チュートリアル: [公式チュートリアルURL]
   - **[別のライブラリ]**: [公式ドキュメントURL]
     - 実装で参照した機能: [具体的な機能のドキュメントURL]

   ## コミュニティの知見

   ### GitHub Issues/Discussion
   - **関連Issue #XXX**: [URL] - [問題の概要と解決策]
   - **Discussion**: [URL] - [設計決定の議論]
   - **PR #YYY**: [URL] - [実装の改善提案]

   ### よくある問題と解決策
   - **問題**: [よくある落とし穴]
     - **解決策**: [推奨される回避方法]
     - **参考**: [Stack Overflow等のリンク]

   ## 依存関係
   [require/importしているライブラリ・モジュール]

   ## クラス/モジュール構造
   [クラス階層やモジュール構成を図示]

   ## インターフェースと実装

   ### 公開API
   [外部から使用可能なメソッド/関数のインターフェース仕様]

   ### 内部実装
   [ツールやライブラリの実際の使われ方、言語仕様の活用]

   ## 主要メソッド

   ### `method_name(args)` - 説明
   [メソッドの役割、引数、戻り値]
   
   **なぜこの実装なのか**:
   - 設計上の理由: [このアプローチを選んだ理由]
   - 代替案との比較: [他の実装方法との比較]
   - パフォーマンス考慮: [最適化のポイント]
   
   **言語仕様/ライブラリ機能の活用**:
   - 使用している言語機能: [例: ジェネリクス、async/await、デコレータ等]
     - 基礎解説: [初心者向けの概念説明]
     - この場面での活用: [なぜこの機能を使うのか]
   - ライブラリAPIの使い方: [具体的なAPI呼び出しパターン]

   **入出力例**:
   ```ruby
   # 入力
   input = "example"

   # 実行
   result = method_name(input)

   # 出力（実際にデバッグ時に表示される値）
   puts result.inspect
   #=> "expected result"

   # 中間データの構造
   puts result.class  #=> String
   puts result.length #=> 15
   ```

   ## データフロー
   [入力から出力までの流れを図示]
   [手元のコードでの実際の使用例を含む]

   ## デバッグ手法

   ### REPL/コンソールでの確認
   ```ruby
   # 最小単位での動作確認
   require 'module_name'
   result = ModuleName.method("input")
   puts result.inspect
   ```

   ### ログ出力での追跡
   [デバッグ時に有用なログポイント]

   ### テストでの検証
   ```ruby
   # 単体テストの例
   it 'does something' do
     expect(ModuleName.method("input")).to eq("output")
   end
   ```

   ## 注意点・設計判断
   
   ### アーキテクチャ上の決定
   - **選択した理由**: [なぜこの設計を選んだか]
   - **トレードオフ**: [犠牲にした点と得られた利点]
   - **将来の拡張性**: [どのように拡張可能か]
   
   ### 言語仕様の制約と回避策
   - **制約**: [言語の制限事項]
   - **回避策**: [どのように対処したか]
   - **学び**: [この経験から得られる知見]

   ## さらなる学習のために

   ### 推奨リソース
   - **書籍**: [この分野を深く理解するための書籍]
   - **コース/チュートリアル**: [オンライン学習リソース]
   - **実践プロジェクト**: [理解を深めるための課題]
   
   ### 次のステップ
   1. [このコードを理解した後に学ぶべきこと]
   2. [応用可能な別の領域]
   3. [より高度な実装パターン]

   ## 関連ファイル
   [このモジュールと連携する他のファイル]
   [実際のプロジェクトでの使用例へのパス]
   ```

8. **出力と保存**
   - **Claude Codeの出力として結果を表示**（必須）
   - ユーザーの学習進捗に合わせた説明レベルの調整
   - 必要に応じて追加の学習リソースを提案

## 出力形式

### 必須要件
- 日本語で記述
- **公式ドキュメントへのリンクを必ず含める**
- **GitHub Issues/Discussionから実際の問題と解決策を含める**
- **言語仕様の基礎から応用まで段階的に説明**

### 教育的配慮
- **初心者も理解できるよう基礎概念を丁寧に説明**
- **なぜそう実装するのか、設計の理由を明確に**
- **よくある間違いと正しい理解を対比**
- **実践的な例を通じて概念を説明**

### 実用性
- コード例は元のコードから抜粋し、実際の使われ方を示す
- デバッグ時にコピペで使える具体的なコード例
- 図やテーブルを活用して視覚的に理解しやすく
- **次の学習ステップを明確に提示**

### 深い理解の促進
- **ツール・ライブラリのインターフェースから言語仕様まで丁寧に解説**
- **実装の代替案と比較検討**
- **パフォーマンスへの影響と最適化のポイント**
- **将来的な拡張や改善の可能性**

## 例

```
/module-doc lib/rfmt/prism_bridge.rb
```

→ `docspriv/module_read/prism_bridge.md` に解説ドキュメントを生成

```
/module-doc
```

→ ユーザーに対象モジュールを質問してから生成
