# Phase 3: Approach Comparison（修正方針の比較検討）

## 目的

Phase 2 で理解した問題に対し、複数の修正アプローチを比較検討し、最適な戦略をユーザーと合意する。

## サブエージェント戦略

### Plan エージェント

`Task(Plan)` で各アプローチの分析を委譲:

```
プロンプト: "以下の問題に対する修正アプローチを分析してください。
[Phase 1 のサマリーと Phase 2 の理解を提供]

各アプローチについて:
- 実現可能性
- コードベースの既存パターンとの整合性
- 変更範囲と影響範囲の推定
- リスクと懸念点"
```

### WebSearch

- 類似問題に対する OSS コミュニティの過去の対応を検索
- 公式ドキュメントでの推奨パターンを確認
- 関連する RFC やベストプラクティスを収集

## 分析フレームワーク

### 3.1 アプローチの列挙

最低2つ、理想的には3つの修正アプローチを提案する:

```markdown
## 修正アプローチ一覧

### アプローチ A: {名前}
**概要**: {1-2文で説明}
**修正範囲**: {変更するファイル・関数のリスト}
**難易度**: {低 / 中 / 高}

### アプローチ B: {名前}
**概要**: {1-2文で説明}
**修正範囲**: {変更するファイル・関数のリスト}
**難易度**: {低 / 中 / 高}

### アプローチ C: {名前}（ある場合）
...
```

### 3.2 トレードオフ比較表

| 観点 | アプローチ A | アプローチ B | アプローチ C |
|------|------------|------------|------------|
| 修正の局所性（変更ファイル数） | | | |
| 既存テストへの影響 | | | |
| パフォーマンスへの影響 | | | |
| 後方互換性 | | | |
| コミュニティ受容性 | | | |
| 長期保守性 | | | |

### 3.3 推奨と根拠

```markdown
## 推奨アプローチ: {名前}

**根拠**:
1. {理由1}: {詳細}
2. {理由2}: {詳細}
3. {理由3}: {詳細}

**リスクと対策**:
- リスク: {内容} → 対策: {内容}
```

### 3.4 OSSコミュニティへの考慮

PR がレビューされやすくなるための考慮:

- **変更の粒度**: 小さな PR が好まれる場合、修正を分割する案を検討
- **コーディング規約**: リポジトリの `.editorconfig`, `eslint`, `rustfmt` 等の設定に準拠
- **テストカバレッジ**: プロジェクトのテスト方針（カバレッジ閾値、テストスタイル）に合わせる
- **コミットメッセージ**: Conventional Commits 等、プロジェクトの規約に従う

### 3.5 GitHub コミュニケーション（必要な場合）

修正方針について Issue でメンテナーの意見を求める場合:

1. コメントのドラフトを作成（ユーザーにレビューしてもらう）
2. 内容の構成:
   - 問題の理解の要約
   - 検討したアプローチの概要
   - 質問事項や確認したい点
3. ユーザーが投稿するかどうかを決定

## 確認ゲート

1. アプローチ一覧と比較表を提示
2. 「どのアプローチを採用しますか？追加の考慮事項はありますか？」と確認
3. ユーザーが明示的にアプローチを選択したら Phase 4 へ進む
4. どのアプローチにも納得しない場合: ユーザーの案を聞き、同じフレームワークで分析
