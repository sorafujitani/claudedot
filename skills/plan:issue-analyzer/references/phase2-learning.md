# Phase 2: User Learning（ユーザーのハンズオン学習）

## 核心原則

**AIはコードを書かない。ユーザーが自分の手で理解する。**

- 何を、どこに書くべきかをガイドする
- なぜその変更が必要なのか、深い理解を提供する
- ユーザーは「見る」のではなく「やる」ことで学ぶ
- 答えを直接与えず、理解に導く

## サブエージェント戦略

`Task(Explore)` x1 で事前調査:
- 問題に関連するテストファイルのパスと構造
- 最小再現に必要なファイルと設定
- print debug を仕込むべき箇所の候補
- テスト実行に必要な環境セットアップ

## 学習メソッド

状況に応じて以下から選択・組合せる。複雑な問題では複数メソッドを段階的に使用する。

### メソッド 1: Print Debugging（バグの動的理解向け）

問題の実行時の振る舞いを観察して原因を理解する。

**ステップ 1: 観察ポイントの指定**

場所と方針のみ伝え、具体的なコードは書かない:

```
### あなたの作業
**ファイル**: `src/parser.ts`
**何をするか**: `parseToken` 関数の先頭で、引数 `token` の値と型を出力する print 文を追加してください

### 実行と観察
**コマンド**: `npm test -- --grep "parse edge case"`
**注目ポイント**: token の値が期待通りの型で渡されているか
```

**ステップ 2: 結果の分析ガイド**
- 「出力の {この部分} に注目してください」
- 「期待値と実際の値の差分は何ですか？」

**ステップ 3: 追加観察の指示**
- 1回目の観察結果に基づき、より深い箇所に print を追加
- 問題の発生経路を段階的に絞り込む

### メソッド 2: 最小再現ケース（バグの再現と隔離向け）

問題を最小限のコードで再現し、本質を隔離する。

**ステップ 1: 正常動作の確認**
- 「まず正常に動作するケースを確認しましょう」
- 正常ケースの入力と期待される出力を提示

**ステップ 2: 段階的な変異**
- 正常ケースから1つずつ条件を変えて問題に近づける
- 各段階で「何が変わったか」「なぜ結果が変わったか」をユーザーに考えさせる

**ステップ 3: 最小再現の確立**
- 問題を引き起こす最小限の条件セットを特定
- 「この再現ケースから、問題の原因は何だと思いますか？」

### メソッド 3: 失敗するユニットテスト（TDD 準備向け）

期待される振る舞いをテストで表現し、現状との乖離を体感する。

**ステップ 1: テスト方針の提示**

テストの方向性を自然言語で説明する（コードは書かない）:

```
### あなたの作業
**ファイル**: `tests/parser.test.ts`（新規作成）
**テスト対象**: `parseToken` 関数が特殊文字を含む入力を正しく処理すること
**入力**: `"hello\nworld"` （改行を含む文字列）
**期待値**: `{ type: "string", value: "hello\nworld" }` を返す
**ヒント**: 既存のテスト `tests/lexer.test.ts` のパターンを参考にしてください
```

**ステップ 2: テスト実行と失敗確認**
- テスト実行コマンドを提示
- 「テストが失敗するはずです。エラーメッセージを確認してください」
- 「エラーメッセージから、コードのどこに問題があるかわかりますか？」

**ステップ 3: 失敗の意味の理解**
- 「このテストが成功するためには、コードのどこが変わる必要がありますか？」
- Phase 4 の TDD サイクルへの橋渡し

## 理解度チェック

Phase 1 のサマリーをベースに、質問形式で理解度を確認する。全て自分の言葉で回答してもらう:

1. **原因の理解**: 「この問題の原因を自分の言葉で説明してください」
2. **影響範囲の理解**: 「この問題が他のどの機能に影響するか、列挙できますか？」
3. **修正の方向性**: 「修正アプローチとして何が考えられますか？」（Phase 3 への橋渡し）

### 理解度が不十分な場合

- 別のメソッドを提案（print debug → 再現ケース → テスト の順で試行）
- より細かいステップに分割して再ガイド
- 関連する概念や背景知識を補足
- **決して答えを直接与えない**

### 理解度が十分な場合

チェックリストで確認:
```
Phase 2 完了条件:
- [ ] 問題の原因を自分の言葉で説明できた
- [ ] 影響範囲を理解している
- [ ] 少なくとも1つの修正アプローチを思いつく
```

## 確認ゲート

理解度チェック通過後:
1. 進捗チェックリストを更新表示
2. 「Phase 2 の学習は十分ですか？ Phase 3（修正方針の比較検討）に進みますか？」
3. ユーザーの「OK」で Phase 3 へ
